apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-fastapi-to-postgres
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: fastapi
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: postgres
      ports:
        - protocol: TCP
          port: 5432

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-fastapi-to-redis
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: fastapi
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: redis
      ports:
        - protocol: TCP
          port: 6379

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-worker-to-kafka
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: worker
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: kafka
      ports:
        - protocol: TCP
          port: 9092

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-kafka-ui-to-kafka
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: kafka-ui
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: kafka
      ports:
        - protocol: TCP
          port: 9092

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-init-to-all
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: kafka
      ports:
        - protocol: TCP
          port: 9092
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: postgres
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: redis
      ports:
        - protocol: TCP
          port: 6379

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-prometheus-to-postgres-exporter
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: prometheus
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: postgres-exporter
      ports:
        - protocol: TCP
          port: 9187

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-pgadmin-to-postgres
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: pgadmin
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: postgres
      ports:
        - protocol: TCP
          port: 5432

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-monitoring-communication
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: grafana
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: prometheus
      ports:
        - protocol: TCP
          port: 9090
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: loki
      ports:
        - protocol: TCP
          port: 3100
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: tempo
      ports:
        - protocol: TCP
          port: 3200

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: davtroelkpyjs
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-app-pods-to-deps
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-postgres-ingress
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      ports:
        - protocol: TCP
          port: 5432

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-redis-ingress
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: redis
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      ports:
        - protocol: TCP
          port: 6379

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-kafka-ingress
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: kafka
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      ports:
        - protocol: TCP
          port: 9092

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-spring-to-mongodb
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: spring-app
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: mongodb
      ports:
        - protocol: TCP
          port: 27017

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-spark-to-kafka
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: spark-master
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: kafka
      ports:
        - protocol: TCP
          port: 9092

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-spark-to-mongodb
  namespace: davtroelkpyjs
spec:
  podSelector:
    matchLabels:
      app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
      component: spark-master
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: website-db-vault-kaf-redis-arg-kust-kyv-elk-apm-sprig-spar
              component: mongodb
      ports:
        - protocol: TCP
          port: 27017
